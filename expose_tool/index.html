<!doctype html>
<html lang="en">
<head>
<title>Areas of Interest (AOIs) | Modeling and Analysis</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">

        <meta property="og:image:width"      content="1200" />
        <meta property="og:image:height"     content="627" />
<!-- jquery -->
<script data-require="jquery@3.1.1" data-semver="3.1.1" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<style>
html,body{padding:0;margin:0;height:100%;width:auto;background-color:gray;overflow-y:hidden;}
#m{
position: relative;margin:0;padding:0;background-color:#2c5283;
height: calc(100vh - 110px);
width: inherit;}
.header{font-size:2.5em;background-color:#2c5283;color:white;display:inline;}
.panel-heading{border-radius:0px;color:white;background:#2c5283;border-bottom-style:solid;border-width:thin;border-color:black;}
.panel-footer{border-radius:0px;border-top-color:black;color:white;font-size:0.95em;font-family:monospace;background:#2c5283;bottom:0;width:100%;}
.logo{}
.title{padding-left:1em;font-size:2em;font-family: 'Oswald', sans-serif;display:inline;vertical-align:middle;}
@media screen and (max-width: 390px) {
  div.title {
    font-size: 1.75em;
  /* div.panel-footer{font-size:0.7em;} */
  }
}
@media screen and (max-width: 350px) {
  div.title {
    font-size: 1.5em;
  /* div.panel-footer{font-size:0.65em;} */
  }
}
@media screen and (max-width: 350px) {
  div.title {
    font-size: 1.25em;
  }
  div.panel-footer{font-size:0.85em;}
}
.nav_btns{float:right;}
#sectiorchem_Btn{bottom:2%;left:2.5%;position:absolute;z-index:750;border-radius:5px;}
#a1_Btn{bottom:1%;left:15%;position:absolute;z-index:750;}
a:link,a:visited,a:hover,a:active{color:white;}
.clearBtn{bottom:2%;left:0%;position:absolute;z-index:750;box-shadow: 0 10px 10px rgba(0,0,0,0.2);color:white;}
#sidebar{height:500px;width:250px;z-index:10000;position:absolute;background-color:white;top:25%;left:1.5%;display:none;border-radius:5px;border-style:solid;border-width:thin;border-color:black;box-shadow: 0 0 10px rgba(0,0,0,0.5)}
.basemap1,.basemap2,.basemap3{box-shadow: 0 10px 10px rgba(0,0,0,0.2);}
.basemap1	{border-style:none;position: absolute;top: 1%;left: 6%;z-index:3000;height:42px;width:45px;border-radius:50px;background-color:#30343E;color:white;}
.basemap2	{border-style:none;position: absolute;top: 1%;left: 10%;z-index:3000;height:42px;width:45px;border-radius:50px;background-color:#30343E;color:white;}
.basemap3	{border-style:none;position: absolute;top: 1%;left: 14%;z-index:3000;height:42px;width:45px;border-radius:50px;background-color:#30343E;color:white;}
.btn-default:hover{background-color:#3f4451;color:white;}
.selected{background:#5ed4ff;transform:scale(1.25);}
.hidden{display:none;}
</style></head>
<body>

<div class="panel-heading"><img height=50 width=50 src="./img/dhs.svg"><div class="title">Areas of Interest (AOIs) | Modeling and Analysis</div>
<span class="nav_btns">
  <ul class="nav navbar-nav">
    <!-- <li><a target="_blank" href="http://r6gis.fema.net/demo41" data-toggle="collapse"data-target=".navbar-collapse.in" id="home-btn"><i class="fa fa-home"></i>&nbsp;&nbsp;Report</a></li> -->
    <li><a target="_blank" href="https://fema.maps.arcgis.com/home/webmap/viewer.html?webmap=a56f125f9a3040b2a41f56512700adbd" data-toggle="collapse" data-target=".navbar-collapse.in" id="about-btn"><i class="fa fa-question-circle white"></i>&nbsp;&nbsp;Edit AOI</a></li>
  </ul>
</span>
</div>
<div id="m">

<button class='basemap1' data-toggle="tooltip" data-placement="bottom" title="Tooltip on bottom"><i class="fa fa-area-chart fa-2x" aria-hidden="true"></i></button>
<button class='basemap2'><i class="fa fa-road fa-2x" aria-hidden="true"></i></button>
<button class='basemap3'><i class="fa fa-globe fa-2x" aria-hidden="true"></i></button>
<button id="sectiorchem_Btn" class="btn-warning"><div class="col-xs-6"><b>EXPOSURE<br> NUMBERS</b></div></button>
<!-- <button id="a1_Btn"  class="btn-default watch_warnBtn"><div class="col-xs-6"<b>Watches and <br> Warnings</b></div></button> -->
<a class="btn btn-danger clearBtn hidden" href="https://dduskin.github.io/expose_tool" role="button"><b>Back</b></a>
<div id="sidebar" class="hide_element">
  <div class="col-xs-12"><b>Click Area of Interest (AOIs)</b><br>
  <div id="aoi_name"></div>
  <div id="counts1"></div>
  <div id="counts2"></div>
  <div id="counts3"></div>
  <div id="counts4"></div>
  <div id="counts5"></div>
  <div id="counts6"></div>
  <div id="counts7"></div>
  <div id="counts8"></div>
  <div id="counts9"></div>
  <div id="counts10"></div>
  <div id="counts11"></div>
  <div id="counts12"></div>
  <div id="counts13"></div>
  <div id="counts14"></div>
  <div id="counts15"></div>
  <!-- <div id="counts16"></div> -->
</div>
  </div>
</div>
</div>

<div class="panel-footer">Generated by FEMA Region 6</div>
<script src="./js/leaflet.js"></script>
<script src="https://unpkg.com/esri-leaflet@2.2.3/dist/esri-leaflet.js" integrity="sha512-YZ6b5bXRVwipfqul5krehD9qlbJzc6KOGXYsDjU9HHXW2gK57xmWl2gU6nAegiErAqFXhygKIsWPKbjLPXVb2g==" crossorigin=""></script>
<script>
const m = L.map("m",{center:[31,-91],zoom:6});
var CartoDB_Voyager = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
});
var google_terrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
maxZoom: 21,
attribution: '&copy; <a href="http://www.google.com">Google</a>',
subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
});
var google_hybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {maxZoom: 21,attribution: '&copy; <a href="http://www.google.com">Google</a>',subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
});
$(".basemap1").click(function() {
        $(".basemap1").addClass('selected');
        $(".basemap2").removeClass('selected');
        $(".basemap3").removeClass('selected');
        m.removeLayer(CartoDB_Voyager);
        m.removeLayer(google_hybrid);
        m.addLayer(google_terrain);
   });
   $(".basemap2").click(function() {
           $(".basemap2").addClass('selected');
           $(".basemap1").removeClass('selected');
           $(".basemap3").removeClass('selected');
           m.addLayer(CartoDB_Voyager);
           m.removeLayer(google_hybrid);
           m.removeLayer(google_terrain);
      });
      $(".basemap3").click(function() {
              $(".basemap3").addClass('selected');
              $(".basemap1").removeClass('selected');
              $(".basemap2").removeClass('selected');
              m.removeLayer(CartoDB_Voyager);
              m.addLayer(google_hybrid);
              m.removeLayer(google_terrain);
         });
m.addLayer(google_hybrid);
$(".basemap3").addClass('selected');

// const watches_warn = L.esri.featureLayer({url:"https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Forecasts_Guidance_Warnings/watch_warn_adv/MapServer/1",
// style: function (feature) {
//   if(feature.properties.phenom === 'SV'){
//     return {color: 'yellow', weight: 2 };
//   } else if(feature.properties.phenom === 'MA'){
//     return { color: 'orange', weight: 2 };
//   } else if(feature.properties.phenom === 'TO'){
//     return { color: 'red', weight: 2 };
//   } else {
//     return { color: 'lime', weight: 2 };
//   }
// }
// });
// $(".watch_warnBtn").click(function() {
//     if(m.hasLayer(watches_warn)){
//       m.removeLayer(watches_warn)} else {
//       m.addLayer(watches_warn);
//     }
        $(".basemap3").addClass('selected');
        $(".basemap1").removeClass('selected');
        $(".basemap2").removeClass('selected');
        m.removeLayer(CartoDB_Voyager);
        m.addLayer(google_hybrid);
        m.removeLayer(google_terrain);
   // });
var aoiUrl = "https://services.arcgis.com/XG15cJAlne2vxtgt/arcgis/rest/services/r6_aoi_exposure_tool/FeatureServer/0";
// var warnUrl = "https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Forecasts_Guidance_Warnings/watch_warn_adv/MapServer/1";

var warnings = L.esri.featureLayer({
 url:'https://services.arcgis.com/XG15cJAlne2vxtgt/arcgis/rest/services/r6_aoi_exposure_tool/FeatureServer/0',
  // url:'https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Forecasts_Guidance_Warnings/watch_warn_adv/MapServer/1',
  style: function (feature) { return {color:'red'}}
  // style: function (feature) {
  //   if(feature.properties.phenom === 'SV'){
  //     return {color: 'yellow', weight: 2 };
  //   } else if(feature.properties.phenom === 'MA'){
  //     return { color: 'orange', weight: 2 };
  //   } else if(feature.properties.phenom === 'TO'){
  //     return { color: 'red', weight: 2 };
  //   } else {
  //     return { color: 'lime', weight: 2 };
  //   }
  // }
}).addTo(m);
var query = L.esri.query({url: aoiUrl}).run(function(error, aoi) {
var aois = L.geoJSON(aoi).setStyle({color: 'red',fillOpacity: 0.1,weight:4});

m.fitBounds(aois.getBounds().pad(0.5));

});
  document.getElementById('sectiorchem_Btn').onclick = function(){toggleClass()};
  function toggleClass(){
    let x = document.getElementById('sidebar');
    if (x.style.display === 'block'){
    x.style.display = 'none';
    } else {
      x.style.display = 'block';
    }
    }
    warnings.on('popupopen', function(evt) {
      queryAoi(evt.layer.feature, evt.popup);
      queryPop(evt.layer.feature, evt.popup);
      queryFirestations(evt.layer.feature, evt.popup);
      queryPolicestations(evt.layer.feature, evt.popup);
      queryCelltowers(evt.layer.feature, evt.popup);
      queryPublicSchools(evt.layer.feature, evt.popup);
      queryPrivSchools(evt.layer.feature, evt.popup);
      queryHospitals(evt.layer.feature, evt.popup);
      queryNursinghomes(evt.layer.feature, evt.popup);
      queryPharms(evt.layer.feature, evt.popup);
      queryVha(evt.layer.feature, evt.popup);
      queryAirports(evt.layer.feature, evt.popup);
      queryDams(evt.layer.feature, evt.popup);
      queryPower(evt.layer.feature, evt.popup);
      queryWastewater(evt.layer.feature, evt.popup);
      // queryFootprints(evt.layer.feature, evt.popup);
      queryFootprints2(evt.layer.feature, evt.popup);
      // queryRiver(evt.layer.feature, evt.popup);
        $(".clearBtn").removeClass('hidden');
        $(".clearBtn").animate({left: '200px', opacity: '1'}, "slow");
    });

    warnings.bindPopup(function (layer) {
    	return L.Util.template('<p>Getting CIKR for '+layer.feature.properties.AOI_NAME+"</p>");
      // document.getElementById("aoi_name").innerHTML = layer.feature.properties.AOI_NAME;
    });



   //  function clearLayers(){
   //   m.removeLayer(firestation_);
   // }
   var queryAoi = function(feature, popup) {
     L.esri.query({
       url:'https://services.arcgis.com/XG15cJAlne2vxtgt/arcgis/rest/services/r6_aoi_exposure_tool/FeatureServer/0'
     })
     .intersects(feature)
     .run(function(error, featureCollection) {
        var aoi_select = L.geoJSON(featureCollection).setStyle({color:'red',fillOpacity:0.0}).addTo(m);
             m.fitBounds(aoi_select.getBounds().pad(0.05));
     }.bind(this));

   }
    var queryPop = function (feature, popup) {
    L.esri.query({
    url:'https://services.arcgis.com/XG15cJAlne2vxtgt/arcgis/rest/services/Cam4v_ZDFDx___Bh/FeatureServer/0'
  }).within(feature).run(function(error, featureCollection) {
    var sumNight = 0;
    for (var i = 0; i < featureCollection.features.length; i++){
     sumNight += featureCollection.features[i].properties.F_prototype;
    }
      document.getElementById('counts1').innerHTML =
      "Population (Night): "+sumNight;
    }.bind(this));
  };
    var queryFirestations = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Fire_Stations/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
      const firestationIcon = L.icon({iconUrl:'http://fema.maps.arcgis.com/sharing/rest/content/items/99d9c8231df247e186db20cc5aaf5ef6/data',iconSize:[36,36]});
      var firestation_ = L.geoJSON(featureCollection,{ pointToLayer: function(feature, latlng){
        return L.marker(latlng,{icon:firestationIcon});
      }});
      if (m.hasLayer(firestation_)){
        m.removeLayer(firestation_);
      }else{
        m.addLayer(firestation_)
      };
      firestation_.eachLayer(function(layer) {
      var firestation_Tool_poptip = layer;
      firestation_Tool_poptip.bindTooltip("Fire Dept.<b> | "+layer.feature.properties.CITY+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
      firestation_Tool_poptip.bindPopup(
     "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Telephone</td><td>"
     +layer.feature.properties.TELEPHONE+"</td></tr><tr><td>Address</td><td>"+layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY+
     "</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Zipcode</td><td>"+layer.feature.properties.ZIP+
     "</td></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICSDESCR+"</td></tr><tr><td>Type</td><td>"+layer.feature.properties.TYPE+"</td></tr><tr><td>Total Staff</td><td>"+layer.feature.properties.TOTALPERS+"</td></tr></tbody</table>",
     {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});});
      document.getElementById("counts2").innerHTML = ("Fire Stations: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryPolicestations = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Local_Law_Enforcement_Locations/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const policestationIcon = L.icon({iconUrl:'./img/police.png',iconSize:[26,62]});
        var policestation_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:policestationIcon});
        }});
        if (m.hasLayer(policestation_)){
          m.removeLayer(policestation_);
        }else{
            m.addLayer(policestation_)
        };
        policestation_.eachLayer(function(layer) {
              var policestation_Tool_poptip = layer;
              policestation_Tool_poptip.bindTooltip("Police Dept.<b> | "+layer.feature.properties.CITY+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             policestation_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Telephone</td><td>"
               +layer.feature.properties.TELEPHONE+"</td></tr><tr><td>Address</td><td>"+layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY+
               "</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Zipcode</td><td>"+layer.feature.properties.ZIP+
               "</td></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICSDESCR+"</td></tr><tr><td>Type</td><td>"+layer.feature.properties.TYPE+"</td></tr><tr><td>Total Capacity</td><td>"+layer.feature.properties.CAPACITY+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts3").innerHTML = ("Police Stations: "+featureCollection.features.length);

      }.bind(this));
    }
    var queryCelltowers = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Cellular_Towers/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const celltowerIcon = L.icon({iconUrl:'./img/cell.png',iconSize:[26,62]});
        var celltower_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:celltowerIcon});
        }});
        if (m.hasLayer(celltower_)){
            m.removeLayer(celltower_);
        }else{
            m.addLayer(celltower_)
        };
        celltower_.eachLayer(function(layer) {
              var celltower_Tool_poptip = layer;
              celltower_Tool_poptip.bindTooltip("Cell Tower | <b>"+layer.feature.properties.LOCCITY,{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             celltower_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.LICENSEE+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Address</td><td>"+layer.feature.properties.LOCADD+"</td></tr><tr><td>City</td><td>"
               +layer.feature.properties.LOCCITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.LOCSTATE+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });




        document.getElementById("counts4").innerHTML = ("Cell Towers: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryPublicSchools = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Public_Schools/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const publicschoolIcon = L.icon({iconUrl:'./img/public_school.png',iconSize:[26,62]});
        var publicschoolLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:publicschoolIcon});
        }});
        if (m.hasLayer(publicschoolLayer_)){
            m.removeLayer(publicschoolLayer_);
        }else{
            m.addLayer(publicschoolLayer_)
        };

        publicschoolLayer_.eachLayer(function(layer) {
              var publicschoolLayer_Tool_poptip = layer;
            publicschoolLayer_Tool_poptip.bindTooltip("<b>Public School</b> | "+layer.feature.properties.CITY,{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             publicschoolLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+" | "+layer.feature.properties.CITY+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Address</td><td>"
               +layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY+"</td></tr><tr><td>County</td><td>"+layer.feature.properties.COUNTY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICS_DESC+ "</td></tr><tr><td>Enrollment</td><td>"+layer.feature.properties.ENROLLMENT+"</td></tr></tr><tr><td>Teacher Staff</td><td>"+layer.feature.properties.FT_TEACHER+"</td></tr><tr><td>Starting Grade</td><td>"+layer.feature.properties.ST_GRADE+"</td><tr><td>Ending Grade</td><td>"+layer.feature.properties.END_GRADE+"</td></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts5").innerHTML = ("Public Schools: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryPrivSchools = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Private_Schools/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const privateschoolIcon = L.icon({iconUrl:'./img/private_school.png',iconSize:[26,62]});
        var privateschoolLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:privateschoolIcon});
        }});
        if (m.hasLayer(privateschoolLayer_)){
            m.removeLayer(privateschoolLayer_);
        }else{
            m.addLayer(privateschoolLayer_)
        };
        privateschoolLayer_.eachLayer(function(layer) {
              var privateschoolLayer_Tool_poptip = layer;
            privateschoolLayer_Tool_poptip.bindTooltip("<b>Private School</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             privateschoolLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+" | "+layer.feature.properties.CITY+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Address</td><td>"
               +layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY+"</td></tr><tr><td>County</td><td>"+layer.feature.properties.COUNTY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICS_DESC+ "</td></tr><tr><td>Enrollment</td><td>"+layer.feature.properties.ENROLLMENT+"</td></tr></tr><tr><td>Teacher Staff</td><td>"+layer.feature.properties.FT_TEACHER+"</td></tr><tr><td>Starting Grade</td><td>"+layer.feature.properties.START_GRAD+"</td><tr><td>Ending Grade</td><td>"+layer.feature.properties.END_GRADE+"</td></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts6").innerHTML = ("Private Schools: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryHospitals = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Hospitals/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const hospitalsIcon = L.icon({iconUrl:'./img/hospital.png',iconSize:[26,62]});
        var hospitals_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:hospitalsIcon});
        }});
        if (m.hasLayer(hospitals_)){
            m.removeLayer(hospitals_);
        }else{
            m.addLayer(hospitals_)
        };
        hospitals_.eachLayer(function(layer) {
              var hospitals_Tool_poptip = layer;
              hospitals_Tool_poptip.bindTooltip("Hospital<b> | "+layer.feature.properties.NAME+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             hospitals_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Address</td><td>"+layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"
               +layer.feature.properties.CITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Zipcode Code</td><td>"+layer.feature.properties.ZIP+
               "</td></tr></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICS_DESC+"</td></tr><tr><td>Beds</td><td>"+layer.feature.properties.BEDS+"</td></tr><tr><td>Trauma</td><td>"+layer.feature.properties.TRAUMA+"</td></tr><tr><td>Helipad</td><td>"+layer.feature.properties.HELIPAD+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts7").innerHTML = ("Hospitals: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryNursinghomes = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/NursingHomes/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const nursinghomeIcon = L.icon({iconUrl:'./img/nursinghome.png',iconSize:[26,62]});
        var nursinghomeLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:nursinghomeIcon});
        }});
        if (m.hasLayer(nursinghomeLayer_)){
            m.removeLayer(nursinghomeLayer_);
        }else{
            m.addLayer(nursinghomeLayer_)
        };
        nursinghomeLayer_.eachLayer(function(layer) {
              var nursinghomeLayer_poptip = layer;
              nursinghomeLayer_poptip.bindTooltip("Nursing Home<b> | "+layer.feature.properties.CITY+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             nursinghomeLayer_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Address</td><td>"+layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"
               +layer.feature.properties.CITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Zipcode Code</td><td>"+layer.feature.properties.ZIP+
               "</td></tr></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICS_DESC+"</td></tr><tr><td>Beds</td><td>"+layer.feature.properties.BEDS+"</td></tr><tr><td>Trauma</td><td>"+layer.feature.properties.TRAUMA+"</td></tr><tr><td>Helipad</td><td>"+layer.feature.properties.HELIPAD+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts8").innerHTML = ("Nursing Homes: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryPharms = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Pharmacies/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const pharmacyIcon = L.icon({iconUrl:'./img/pharmacy.png',iconSize:[26,62]});
        var pharmacyLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:pharmacyIcon});
        }});
        if (m.hasLayer(pharmacyLayer_)){
            m.removeLayer(pharmacyLayer_);
        }else{
            m.addLayer(pharmacyLayer_)
        };
        m.removeLayer(warnings);
        pharmacyLayer_.eachLayer(function(layer) {
              var pharmacyLayer_Tool_poptip = layer;
            pharmacyLayer_Tool_poptip.bindTooltip("Pharmacy | <b>"+layer.feature.properties.CITY+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             pharmacyLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+" | "+layer.feature.properties.CITY+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Address</td><td>"
               +layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY+"</td></tr><tr><td>County</td><td>"+layer.feature.properties.COUNTY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Telephone</td><td>"+layer.feature.properties.TELEPHONE+"</td><tr><tr><td>Website</td><td>"+layer.feature.properties.WEBSITE+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts9").innerHTML = ("Pharmacies: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryVha = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Veterans_Health_Administration_Medical_Facilities/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        var vhaOptions = {
            radius: 12,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };
        // const vhaIcon = L.icon({iconUrl:'./img/hospital.png',iconSize:[36,82]});
        var vhaLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, vhaOptions);
        }});
        if (m.hasLayer(vhaLayer_)){
            m.removeLayer(vhaLayer_);
        }else{
            m.addLayer(vhaLayer_)
        };
        vhaLayer_.eachLayer(function(layer) {
              var vhaLayer_Tool_poptip = layer;
              vhaLayer_Tool_poptip.bindTooltip("VHA Medical Facility<b> | "+layer.feature.properties.NAME+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             vhaLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Address</td><td>"+layer.feature.properties.ADDRESS+"</td></tr><tr><td>City</td><td>"
               +layer.feature.properties.CITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Zipcode Code</td><td>"+layer.feature.properties.ZIP+
               "</td></tr></tr><tr><td>Description</td><td>"+layer.feature.properties.NAICSDESCR+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });


        document.getElementById("counts10").innerHTML = ("VHA MedicalFacilities: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryAirports = function(feature, popup) {
      L.esri.query({
      	url:'https://services6.arcgis.com/ssFJjBXIUyZDrSYZ/arcgis/rest/services/US_Airport/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const airportIcon = L.icon({iconUrl:'./img/airport.png',iconSize:[26,62]});
        var airport_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:airportIcon});
        }});
        if (m.hasLayer(airport_)){
            m.removeLayer(airport_);
        }else{
            m.addLayer(airport_)
        };
        airport_.eachLayer(function(layer) {
              var airport_Tool_poptip = layer;
              airport_Tool_poptip.bindTooltip("Airport<b> | "+layer.feature.properties.NAME+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             airport_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>City</td><td>"
               +layer.feature.properties.SERVCITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Military Code</td><td>"+layer.feature.properties.MIL_CODE+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts11").innerHTML = ("Airports: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryDams = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/8DJsAMKuU5pXLFcd/arcgis/rest/services/Major_Dams_of_the_United_States/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        var damOptions = {
            radius: 10,
            fillColor: "black",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };
        // const vhaIcon = L.icon({iconUrl:'./img/hospital.png',iconSize:[36,82]});
        var damLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, damOptions);
        }});
        if (m.hasLayer(damLayer_)){
            m.removeLayer(damLayer_);
        }else{
            m.addLayer(damLayer_)
        };
        damLayer_.eachLayer(function(layer) {
              var damLayer_Tool_poptip = layer;
              damLayer_Tool_poptip.bindTooltip("Dam <b>("+layer.feature.properties.HAZARD+") | "+layer.feature.properties.DAM_NAME+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             damLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.DAM_NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>City</td><td>"
               +layer.feature.properties.CITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE+"</td></tr><tr><td>Dam Hazard</td><td>"+layer.feature.properties.HAZARD+"</td></tr><tr><td>Dam Height</td><td>"+layer.feature.properties.NID_HEIGHT+"</td></tr><tr><td>Dam Type</td><td>"+layer.feature.properties.DAM_TYPE+"</td></tr><tr><td>Max Storage</td><td>"+layer.feature.properties.MAX_STOR+"</td></tr><tr><td>Normal Storage</td><td>"+layer.feature.properties.NORMAL_STO+"</td></tr><tr><td>Surface Area</td><td>"+layer.feature.properties.SURF_AREA+"</td></tr><tr><td>Drainage Area</td><td>"+layer.feature.properties.DRAIN_AREA+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts12").innerHTML = ("Dams: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryPower = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Environmental_Protection_Agency_EPA_Facility_Registry_Service_FRS_Power_Plants/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const powerplantsIcon = L.icon({iconUrl:'./img/powerplant.png',iconSize:[26,62]});
        var powerplantsLayer_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:powerplantsIcon});
        }});
        if (m.hasLayer(powerplantsLayer_)){
            m.removeLayer(powerplantsLayer_);
        }else{
            m.addLayer(powerplantsLayer_)
        };
        powerplantsLayer_.eachLayer(function(layer) {
              var powerplantsLayer_Tool_poptip = layer;
              powerplantsLayer_Tool_poptip.bindTooltip("Power Plant<b> | "+layer.feature.properties.UTILITY_NA+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             powerplantsLayer_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.UTILITY_NA+" | "+layer.feature.properties.CITY_NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody><tr><td>Address</td><td>"
               +layer.feature.properties.LOCATION_A+"</td></tr></td></tr><tr><td>City</td><td>"+layer.feature.properties.CITY_NAME+
               "</td></tr><tr><td>State</td><td>"+layer.feature.properties.STATE_CODE+"</td></tr><tr><td>Zipcode</td><td>"+layer.feature.properties.POSTAL_COD+"<tr><td>Energy Source</td><td>"+layer.feature.properties.ENERGY_SRC+"<tr><td>Secondary Fuel</td><td>"+layer.feature.properties.ENERGY_S_6+"</td></tr><tr><td>Output Capacity Total</td><td>"+layer.feature.properties.NAMEPL_CAP+" (MW)</td></tr><tr><td>Output Capacity Total (Summer)</td><td>"+layer.feature.properties.SUMMER_CAP+" (MW)</td></tr><tr><td>Output Capacity Total (Winter)</td><td>"+layer.feature.properties.WINTER_CAP+" (MW)</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts13").innerHTML = ("Power Plants: "+featureCollection.features.length);
      }.bind(this));
    }
    var queryWastewater = function(feature, popup) {
      L.esri.query({
      	url:'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Environmental_Protection_Agency_EPA_Facility_Registry_Service_FRS_Wastewater_Treatment_Plants/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
        const wastewaterplantIcon = L.icon({iconUrl:'./img/wastewater.png',iconSize:[26,62]});
        var wastewaterplant_ = L.geoJSON(featureCollection,{pointToLayer: function (feature, latlng) {
        return L.marker(latlng,{icon:wastewaterplantIcon});
        }});
        if (m.hasLayer(wastewaterplant_)){
            m.removeLayer(wastewaterplant_);
        }else{
            m.addLayer(wastewaterplant_)
        };
        wastewaterplant_.eachLayer(function(layer) {
              var wastewaterplant_Tool_poptip = layer;
              wastewaterplant_Tool_poptip.bindTooltip("Wastewater Plant<b> | "+layer.feature.properties.CWP_CITY+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
             wastewaterplant_Tool_poptip.bindPopup(
               "<b><span style='font-size:0.8em;'>"+layer.feature.properties.CWP_NAME+"</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Address</td><td>"+layer.feature.properties.CWP_STREET+"</td></tr><tr><td>City</td><td>"
               +layer.feature.properties.CWP_CITY+"</td></tr><tr><td>State</td><td>"+layer.feature.properties.CWP_STATE+"</td></tr><tr><td>Zipcode Code</td><td>"+layer.feature.properties.CWP_ZIP+
               "</td></tr></tr><tr><td>Waterbody</td><td>"+layer.feature.properties.STATE_WATER_BODY_NAME+"</td></tr></tbody</table>",
               {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
        });
        document.getElementById("counts14").innerHTML = ("Wastewater: "+featureCollection.features.length);
      }.bind(this));
    }
    // var queryPower = function(feature, popup) {
    //   L.esri.query({
    //   	url:'https://services2.arcgis.com/FiaPA4ga0iQKduv3/arcgis/rest/services/US_Power_Plants_201612/FeatureServer/0'
    //   })
    //   .within(feature)
    //   .run(function(error, featureCollection) {
    //     document.getElementById("counts12").innerHTML = ("Power Plants: "+featureCollection.features.length);
    //   }.bind(this));
    // }
    // var queryFootprints = function(feature, popup) {
    //   L.esri.query({
    //   	url:'https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/MSBFP2/FeatureServer/0'
    //   })
    //   .within(feature)
    //   .run(function(error, featureCollection) {
    //     document.getElementById("counts12").innerHTML = ("Building Footprints: "+featureCollection.features.length);
    //   }.bind(this));
    // }
    var queryFootprints2 = function(feature, popup) {
      L.esri.query({
      	url:'https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/MSBFP2/FeatureServer/0'
      })
      .within(feature)
      .run(function(error, featureCollection) {
      var query = L.esri.query({
          url: 'https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/MSBFP2/FeatureServer/0'
      });
      query.within(feature);
      // query.count(function(error, count, response){document.getElementById("counts13").innerHTML = ("Building Footprints: "+featureCollection.features+" "+count);}.bind(this));
      query.count(function(error, count, response){document.getElementById("counts15").innerHTML = ("Building Footprints: "+count);}.bind(this));
      }.bind(this));
    }
    // var queryRiver = function(feature, popup) {
    //   L.esri.query({
    //   	url:'https://services.arcgis.com/XG15cJAlne2vxtgt/arcgis/rest/services/r6_rivers_gauged/FeatureServer/0'
    //   })
    //   .intersects(feature)
    //   .run(function(error, featureCollection) {
    //    var rivers_concernLayer = L.geoJSON(featureCollection).setStyle({color:'cyan',fillOpacity:0.0});
    //    rivers_concernLayer.eachLayer(function(layer) {
    //          var rivers_concernLayer_Tool_poptip = layer;
    //          rivers_concernLayer_Tool_poptip.bindTooltip("<b>"+layer.feature.properties.GNIS_NAM_1+"</b>",{className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
    //         rivers_concernLayer_Tool_poptip.bindPopup(
    //           "<b><span style='font-size:0.8em;'>Major Gauged River</span></b><table class='table table-responsive table-hover table-bordered' cellspacing='0px' cellpadding='0px' style='font-size:0.75em;'><tbody></tr><tr><td>Water Body</td><td>"+layer.feature.properties.GNIS_NAM_1+"</td></tr></tbody</table>",
    //           {className:'em_tooltip',permanent: false, offset: [10, 0], sticky: true, direction:'right'});
    //           document.getElementById("counts16").innerHTML = ("Rivers of Concern: "+featureCollection.features.length);
    //    });
    //   }.bind(this));
    // }
    // var queryFootprints2 = function(feature, popup) {
    //   L.esri.query({
    //   	url:'https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/MSBFP2/FeatureServer/0'
    //   })
    //   .within(feature)
    //   .run(function(error, featureCollection) {
      // queryFootprints2.count(function(error, count, response){
      // document.getElementById("counts13").innerHTML = ("Building Footprints: <b> Found " + count + " features");
  //       document.getElementById("counts13").innerHTML = ("Building Footprints2: "+featureCollection.features.length);
  //   }.bind(this));
  // }




</script>
</body>
</html>
